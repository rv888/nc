<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="lightning" content="lnurlp:gamemasters@getalby.com"/>
    <link rel="icon" href="https://gamemasters.social/images/icon.png" sizes="192x192" />
    <meta name="description" content="Nostr Games">
    <meta property="og:description" content="Nostr Games">
    <meta name="keywords" content="nostr, ai, openai, bitcoin">
    <meta property="og:image" content="https://i.nostr.build/onWk.jpg">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.gamemasters.social">
    <link rel="canonical" href="https://www.gamemasters.social">
    <meta property="og:site_name" content="Game Masters">

    <title>Game Masters: Nostr Games</title>
    <meta property="og:title" content="Game Masters: Nostr Games">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: black;
        }
        header,
        section,
        footer {
            color: white;
        }

        .btn-purple {
            background-color: purple;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.25rem;
            text-decoration: none;
            margin: 0.5rem;
        }

        .hero {
            position: relative;
            overflow: hidden;
        }

        .hero img {
            width: 100%;
            height: 75vh;
            object-fit: cover;
        }

        .hero-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .hero-text h1 {
            font-size: 400%;
            text-shadow: 2px 2px 4px #000;
        }

        h2 {
            font-size: 175%;
        }

        footer {
            background-color: #000;
        }
        .image-column {
            width: 30%;
            max-width: 30%;
        }
        .image-column img {
            width: 100%;
            height: auto;
        }
        .table{
            color: #fff;
        }
        .winner_count {
            font-size: 1.2rem;
        }
        .active-link {
            text-decoration: underline;
            font-weight: bold;
        }
        .durations {
            font-size: 80%;
            font-weight: normal;
            float: right;
        }
        a {
            color: #dcdcdc;
        }
        a:hover{
            color: #dc1fdc;
        }
    </style>
</head>

<body>

<!-- Hero image with overlaid text -->
<div class="hero">
    <img src="https://i.nostr.build/8eEJ.jpg" alt="Hero" class="img-fluid">
    <div class="hero-text">
        <h1 class="display-4 font-weight-bold">Game Masters</h1>
        <p>Games on Nostr that zap Satoshis</p>
    </div>
</div>

<!-- Section 1 -->
<section class="py-4">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <img src="https://i.nostr.build/60gq.webp" alt="Game" class="img-fluid">
            </div>
            <div class="col-md-6 text-left">
                <h2>Choose Your Fate Game</h2>
                <p>Play 100+ quick AI-powered Text Based role playing games on Nostr. There are storylines for animal, viking, superhero, pulp, war, action, mystery, treasure, pirate, zombies, fantasy, scifi, robots, terminator, aliens, disaster, wuxia, xianxia, and horror. I will randomly post games which allow anyone to join in and play together. A pool of Sats will be split between all who play if the game is won.</p>
                <a href="nostr:npub1l6jqp0h7kkl3zkck2a0zza4lhk8m32ueskkpwzkmgq4l3jymn59q7ezyfy" class="btn btn-purple">Follow to play</a>
            </div>
        </div>
    </div>
</section>

<!-- Section 2 -->
<section class="bg-dark py-4">
    <div class="container">
        <div class="row">
            <div class="col-md-6 text-right">
                <h2>Trivia Masters</h2>
                <p>I am a general trivia bot that will randomly post questions that you can answer throughout the day. The first to answer a question correctly will win Bitcoin satoshis. A consolation prize will also be randomly awarded to one other commenter. </p>
                <a href="nostr:npub1xcfdvc9whp285aqfn7yjf70e9c53nafzr5a2lr8vkeu4a0g075yq7j8tua" class="btn btn-purple">Follow to play</a>
            </div>
            <div class="col-md-6">
                <img src="https://i.nostr.build/yYxm.png" alt="Trivia" class="img-fluid">
            </div>
        </div>
    </div>
</section>

<!-- Section 3 -->
<section class="py-4">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <img src="https://i.nostr.build/lZxn.webp" alt="Wine" class="img-fluid">
            </div>
            <div class="col-md-6 text-left">
                <h2>Wine Masters Trivia</h2>
                <p>I am a trivia bot and will randomly post mostly wine trivia questions that you can answer throughout the day. The first to answer a question correctly will win Bitcoin satoshis. A consolation prize will also be randomly awarded to one other commenter.</p>
                <a href="nostr:npub1uwsqvds08e9pnvlrpe0dyvkkphrza8rn3hdwsa6hkuumw5msgupsdg54fz" class="btn btn-purple">Follow to play</a>
            </div>
        </div>
    </div>
</section>

<section class="bg-dark py-4">
    <div class="container mt-4">
        <h2>Top Trivia Winners <span class="durations pull-right"><a href="" id="last_7_days">Last 7 Days</a> | <a href="" id="last_month">Last Month</a></span></h2>
        <table class="table table-responsive col-sm-12" id="winners">
            <thead>
            <tr>
                <th class="image-column"></th>
                <th>Name</th>
                <th>Rounds Won</th>
            </tr>
            </thead>
            <tbody id="winners_body">
            </tbody>
        </table>
    </div>
</section>

<!-- Footer -->
<footer class="text-center py-2">
    &nbsp;
</footer>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/nostr-tools/lib/nostr.bundle.js"></script>

<script>

    let relays = ['wss://purplepag.es', 'wss://relay.damus.io', 'wss://relay.damus.io',"wss://relayable.org",
        "wss://relay.primal.net"];
    const pool = new window.NostrTools.SimplePool();
    let winnerTimer, people = [];
    function get_user_details(pk,won){
        var pubKey = window.NostrTools.nip19.npubEncode(pk);

        let sub = pool.sub(
            [...relays],
            [
                {
                    kinds: [0],
                    authors: [pk],
                },
            ],
        )
        sub.on('event', event => {
            var nostrJson = JSON.parse(event.content);
            if (! people.includes(event.pubkey)) {
                people.push(event.pubkey);
                create_div(nostrJson, won, pubKey);
            }
        })
        sub.on('eose', () => {
            sub.unsub()
        })

    }

    function create_div(person,won, pubKey){

        let table = document.getElementById('winners_body'),
            row = document.createElement('tr'),
            cell1 = document.createElement('td'),
            cell2 = document.createElement('td'),
            cell3 = document.createElement('td'),
            a = document.createElement('a'),
            img = document.createElement('img');
        img.src = person.picture;
        img.alt = person.name;
        img.classList.add('img-fluid');
        a.href = "nostr:"+pubKey;
        a.appendChild(img);

        cell1.classList.add('image-column');
        cell1.appendChild(a);
        cell2.innerHTML = person.name;
        cell3.classList.add('winner_count');
        cell3.innerHTML = won;
        row.appendChild(cell1);
        row.appendChild(cell2);
        row.appendChild(cell3);
        table.appendChild(row);

        clearTimeout(winnerTimer);
        runTimer();
    }

    function runTimer(){
        winnerTimer = setTimeout(() => {
            sortTable();
        }, 5000);
    }

    function loadWinners(filename) {
        var url = "https://vsm.sfo3.cdn.digitaloceanspaces.com/wm/" + filename;
        fetch(url)
            .then(response => response.json())
            .then(data => {
                Object.entries(data).forEach(([key, value]) => {
                    console.log(`Key: ${key}, Value: ${value}`);
                    get_user_details(key, value);
                });
            })
            .catch(error => {
                console.error('Error fetching JSON:', error);
            });
    }

    function updateActiveLink(activeLinkId) {
        document.getElementById('last_7_days').classList.remove('active-link');
        document.getElementById('last_month').classList.remove('active-link');
        document.getElementById(activeLinkId).classList.add('active-link');
        people = [];
    }

    function sortTable() {
        console.log("sortTable");
        var tbody, rows, switching, i, x, y, shouldSwitch;
        tbody = document.getElementById("winners").getElementsByTagName("tbody")[0];
        switching = true;
        // Continue until no switching has been done
        while (switching) {
            switching = false;
            rows = tbody.rows;
            // Loop through all table rows
            for (i = 0; i < (rows.length - 1); i++) {
                shouldSwitch = false;
                // Get the two elements you want to compare, one from current row and one from the next
                x = rows[i].getElementsByTagName("td")[2];
                y = rows[i + 1].getElementsByTagName("td")[2];
                // Check if the two rows should switch place, based on descending order
                if (parseInt(x.innerHTML) < parseInt(y.innerHTML)) {
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                // If a switch has been marked, make the switch and mark that a switch has been done
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }
    document.getElementById('last_7_days').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('winners_body').innerHTML = '';
        updateActiveLink('last_7_days');
        loadWinners("7_days.json");
    });

    document.getElementById('last_month').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('winners_body').innerHTML = '';
        updateActiveLink('last_month');
        loadWinners("1_month.json");
    });

    loadWinners("7_days.json");
    updateActiveLink('last_7_days');

    runTimer();


</script>


</body>

</html>
